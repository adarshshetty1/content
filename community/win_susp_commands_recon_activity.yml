id: 0f5ed0706a90490390b01fef227a3ef0
name: Reconnaissance Activity with Net Command
path: /Advanced Threat Detection/Windows Process Monitoring
description: Detects a set of commands often used in recon stages by different attack
  groups
type: standard
author: community
blocks:
- type: text
  code: "|Author|References|\n                 |------|--------|\n               \
    \  |Florian Roth, Markus Neis|https://twitter.com/haroonmeer/status/939099379834658817<br>https://twitter.com/c_APT_ure/status/939475433711722497<br>https://www.fireeye.com/blog/threat-research/2016/05/targeted_attacksaga.html|"
- type: sql
  query: SELECT $CommandLine, count(*) AS agg FROM SYSMON-PROCESS WHERE ($CommandLine
    LIKE "tasklist" OR $CommandLine LIKE "net time" OR $CommandLine LIKE "systeminfo"
    OR $CommandLine LIKE "whoami" OR $CommandLine LIKE "nbtstat" OR $CommandLine LIKE
    "net start" OR $CommandLine LIKE "%\\net1 start" OR $CommandLine LIKE "qprocess"
    OR $CommandLine LIKE "nslookup" OR $CommandLine LIKE "hostname.exe" OR $CommandLine
    LIKE "%\\net1 user /domain" OR $CommandLine LIKE "%\\net1 group /domain" OR $CommandLine
    LIKE "%\\net1 group "domain admins" /domain" OR $CommandLine LIKE "%\\net1 group
    "Exchange Trusted Subsystem" /domain" OR $CommandLine LIKE "%\\net1 accounts /domain"
    OR $CommandLine LIKE "%\\net1 user net localgroup administrators" OR $CommandLine
    LIKE "netstat -an") GROUP BY $CommandLine HAVING agg > 4
- type: signal
  DetectionName: Reconnaissance Activity with Net Command
  DetectionTactic: Discovery
  DetectionTechnique: System Information Discovery
  TargetHost: $System
  DetectionScore: 5
  DetectionConfidence: Low
