id: 0c7c211c3bb64297a172d21ac9e65357
name: In-memory PowerShell
path: /Advanced Threat Detection/Windows Process Monitoring
description: Detects loading of essential DLL used by PowerShell, but not by the process
  powershell.exe. Detects meterpreter's "load powershell" extension.
type: standard
author: community
blocks:
- type: text
  code: "|Author|References|\n                 |------|--------|\n               \
    \  |Tom Kern, oscd.community|https://adsecurity.org/?p=2921<br>https://github.com/p3nt4/PowerShdll|"
- type: sql
  query: SELECT * FROM SYSMON-IMAGE-LOAD WHERE (($ImageLoaded LIKE "%\\System.Management.Automation.Dll"
    OR $ImageLoaded LIKE "%\\System.Management.Automation.ni.Dll") AND NOT (($Image
    LIKE "%\\powershell.exe" OR $Image LIKE "%\\powershell\_ise.exe" OR $Image LIKE
    "%\\WINDOWS\\System32\\sdiagnhost.exe" OR $Image LIKE "%\\mscorsvw.exe" OR $Image
    LIKE "%\\WINDOWS\\System32\\RemoteFXvGPUDisablement.exe")))
- type: signal
  DetectionName: In-memory PowerShell
  DetectionTactic: Execution
  DetectionTechnique: Command and Scripting Interpreter
  TargetHost: $System
  DetectionScore: 5
  DetectionConfidence: Low
