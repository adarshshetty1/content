id: 3ef4d39a2759476b97095affd7aecc69
name: AWS EC2 Download Userdata
path: /Cloud Security/Amazon Web Services
description: Detects bulk downloading of User Data associated with AWS EC2 instances.
  Instance User Data may include installation scripts and hard-coded secrets for deployment.
type: standard
author: community
blocks:
- type: text
  code: "|Author|References|\n                 |------|--------|\n               \
    \  |faloker|https://github.com/RhinoSecurityLabs/pacu/blob/master/modules/ec2__download_userdata/main.py#L24|"
- type: sql
  query: SELECT * FROM (SELECT count(*) AS agg FROM CLOUDTRAIL WHERE ($EventSource
    = "ec2.amazonaws.com" AND RequestParametersAttribute = "userData" AND $EventName
    = "DescribeInstanceAttribute")) WHERE agg > 10
- type: signal
  DetectionName: AWS EC2 Download Userdata
  DetectionTactic: Exfiltration
  DetectionTechnique: Automated Exfiltration
  TargetHost: $EventSource
  DetectionScore: 5
  DetectionConfidence: Low
