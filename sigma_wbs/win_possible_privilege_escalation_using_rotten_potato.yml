id: 50a590f90e6f4b0588a28cb7caff8d6a
name: Detection of Possible Rotten Potato
path: /Advanced Threat Detection/Windows Process Monitoring
description: Detection of child processes spawned with SYSTEM privileges by parents
  with LOCAL SERVICE or NETWORK SERVICE privileges
type: standard
author: community
blocks:
- type: text
  code: "Author: Teymur Kheirkhabarov \n References: ['https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment',\
    \ 'https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/']"
- type: sql
  query: SELECT * FROM SYSMON-PROCESS WHERE ((($ParentUser LIKE "NT AUTHORITY\\NETWORK
    SERVICE" OR $ParentUser LIKE "NT AUTHORITY\\LOCAL SERVICE") AND $User LIKE "NT
    AUTHORITY\\SYSTEM") AND NOT ($Image LIKE "%\\rundll32.exe" AND $CommandLine LIKE
    "%DavSetCookie%"))
- type: signal
  DetectionName: Detection of Possible Rotten Potato
  DetectionTactic: Defense Evasion
  DetectionTechnique: Access Token Manipulation
  TargetHost: $System
  DetectionScore: 5
  DetectionConfidence: Low
