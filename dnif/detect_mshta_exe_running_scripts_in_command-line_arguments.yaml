id: 95a308e77aa24fb186f56f0caa20220f
name: Detect mshta exe running scripts in command-line arguments
path: /Advanced Threat Detection/Windows Process Monitoring
description: ''
type: standard
author: DNIF
blocks:
- type: dql
  query: _fetch * from event where $Stream=SYSMON-PROCESS AND $Duration=15m  AND $CommandLine=regex((?i)(.*mshta.exe*.))
    AND $CommandLine=regex((?i)(.*vbscript*.|.*javascript*.)) group count_unique
    $SrcHost, $CommandLine, $User, $TargetImage limit 10
- type: signal
  DetectionName: Detect mshta exe running scripts in command-line arguments
  DetectionTactic: Defense Evasion
  DetectionTechnique: Signed Binary Proxy Execution
  TargetHost: $System
  DetectionScore: 5
  DetectionConfidence: Low
